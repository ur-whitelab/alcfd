# encoding: utf-8
# 2021 R1
print('Opening ANSYS WB...')
SetScriptVersion(Version="21.1.216")

print('Restoring project from archive...')
Unarchive(
    ArchivePath="alcfd.wbpz",
    ProjectPath="alcfd.wbpj",
    Overwrite=True)

Open(FilePath="alcfd.wbpj")
print('Project loaded.')

# Reading input parameters from file
import csv
input_params = []
with open('inputs.txt', 'r') as file:
    # skipping the header
    next(file)
    input_data = csv.reader(file, delimiter='\t')
    for inputs in input_data:
        input_params.append(inputs)


for input in input_params:
    d, theta, v = input
    designPoint1 = Parameters.GetDesignPoint(Name="0")
    parameter1 = Parameters.GetParameter(Name="P3")
    # parameter1 is pipe radius
    designPoint1.SetParameterExpression(
        Parameter=parameter1,
        Expression="{} [m]".format(d))
    parameter2 = Parameters.GetParameter(Name="P4")
    # parameter2 is bend angle
    designPoint1.SetParameterExpression(
        Parameter=parameter2,
        Expression="{} [degree]".format(theta))
    parameter3 = Parameters.GetParameter(Name="P7")
    # parameter3 is inlet velocity
    designPoint1.SetParameterExpression(
        Parameter=parameter3,
        Expression="{} [m s^-1]".format(v))
    print('Running simulation...')
    Update()
    print('Simulation complete.')
    system1 = GetSystem(Name="FLU")
    print('Exporting results...')
    Parameters.ExportAllDesignPointsData(FilePath="C:/Users/User/Desktop/Research/AL-CFD/alcfd/outputs.txt")
    print('Done!')
